## üêö pu ‚Äî Natural Language CLI Assistant

pu turns natural language into shell commands. It previews, explains, and safely executes commands with guardrails, history, and tooling to iterate.

Highlights:
- Safety guardrails, double confirmation for high‚Äërisk ops
- Secrets redaction everywhere we print or log
- Dry‚Äërun previews and per‚Äëline review for multi‚Äëline commands
- JSONL history with grep and replay
- Configurable model and offline heuristic fallback
- Templates/macros, profiles, and context controls
- Subcommands: `history`, `doctor`, `why`, `edit`

---

## Installation

From source:
```bash
git clone https://github.com/ariadev/pu.git
cd pu
pip install -U openai
chmod +x pu.py
sudo mv pu.py /usr/local/bin/pu
```

Optional: use pipx/venv to isolate dependencies.

---

## Configuration

First run creates `~/.puconfig`.

Minimal example:
```ini
[openai]
api_key = sk-your-api-key-here
model = gpt-4o-mini

[templates]
# Example macro used with: pu -p ":git-clean"
git-clean = git fetch && git reset --hard origin/main && git clean -fdx
```

Environment variable `OPENAI_API_KEY` is respected on first write.

---

## Usage

Basic:
```bash
pu -p "list large files in the current directory"
```

Dry‚Äërun with previews:
```bash
pu -p "rm -rf build dist" --dry-run
```

File context (depth with ignore and cap):
```bash
pu -p "zip project" --with-files 2 --context-ignore node_modules --context-max 200
```

Choose model and profile:
```bash
pu -p "create tar of txt files" --model gpt-4o-mini --profile safe
```

---

## Subcommands

History (JSONL):
```bash
pu history --last 50
pu history --grep docker
pu history --last 10 --replay 3
```

Doctor (env/config check):
```bash
pu doctor
```

Why (brief explanation):
```bash
pu why            # last
pu why --index 2  # specific
```

Edit (iterate on last/specific command):
```bash
pu edit --instruction "add sudo" --dry-run
pu edit --index 3 --instruction "exclude node_modules"
```

---

## Safety and Guardrails

- Risk analysis flags destructive patterns (e.g., `rm -rf /`, `curl | sh`).
- High‚Äërisk requires double confirmation (type the exact command).
- Medium‚Äërisk shows warnings; in `--profile safe`, optional challenge.
- Per‚Äëline review for multi‚Äëline commands.

---

## Secrets and Privacy

- Secrets redacted in output and legacy text history.
- JSONL keeps raw command for replay locally only.
- Use `pu history --grep` to search; `--replay` re‚Äëexecutes with confirmation.

---

## Offline Fallback

If the provider is unavailable, pu falls back to a safe heuristic generator and logs `provider=heuristic` in history.

---

## Examples

```bash
pu -p ":git-clean"
pu -p "start a python http server on port 8080"
pu -p "docker remove all stopped containers"
```

---

## Troubleshooting

- Run `pu doctor` to validate config and environment.
- If OpenAI is not installed, install with `pip install openai`.
- Use `--dry-run` if unsure; read risk warnings carefully.

---

## Notes

Commands are generated by AI. Always review before executing. Use `--dry-run` to preview.

